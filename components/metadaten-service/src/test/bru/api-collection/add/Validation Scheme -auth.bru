meta {
  name: Validation Scheme -auth
  type: http
  seq: 2
}

post {
  url: {{baseUrl}}/admin/app/add/validationscheme?anbieter={{anbieter}}&appname={{appname}}&appversion={{appversion}}
  body: file
  auth: bearer
}

params:query {
  anbieter: {{anbieter}}
  appname: {{appname}}
  appversion: {{appversion}}
}

headers {
  Content-Type: text/plain
}

auth:bearer {
  token: {{dynamic_jwt}}
}

body:file {
  file: @file(data/in/schema-appdata1.json) @contentType(text/plain)
  ~file: @file(data/in/schema-appdata4.json) @contentType(text/plain)
  ~file: @file(data/in/schema-appdata2.json) @contentType(text/plain)
  ~file: @file(data/in/schema-appdata3.json) @contentType(text/plain)
}

assert {
  res.status: eq 200
  res.status: neq 401
}

script:post-response {
  const data = res.body;
    if (data.bundleUuid) {
        bru.setVar("dynamic_schema_id", data.bundleUuid);
    }
}
